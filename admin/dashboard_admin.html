<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Admin</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif}
body{background:#f4f6f9}
header{
background:#111827;
color:#fff;
padding:15px;
text-align:center;
font-size:20px;
font-weight:bold;
}
.container{
padding:15px;
}
.card{
background:#fff;
padding:15px;
border-radius:10px;
box-shadow:0 4px 8px rgba(0,0,0,0.05);
margin-bottom:15px;
}
.card h3{
margin-bottom:8px;
color:#4e54c8;
}
.label{
font-weight:bold;
}
.status-belum{
color:#dc2626;
font-weight:bold;
}
.status-sudah{
color:#16a34a;
font-weight:bold;
}
.button-group{
margin-top:10px;
display:flex;
gap:8px;
}
button{
flex:1;
padding:8px;
border:none;
border-radius:6px;
cursor:pointer;
font-weight:bold;
}
.btn-approve{
background:#16a34a;
color:#fff;
}
.btn-delete{
background:#dc2626;
color:#fff;
}
.logout{
margin-top:20px;
background:#111827;
color:#fff;
width:100%;
}
.empty{
text-align:center;
color:#888;
margin-top:20px;
}
</style>
</head>
<body>

<header>Dashboard Admin</header>

<div class="container" id="dataContainer"></div>

<div class="container">
<button class="logout" onclick="location.href='login_admin.html'">Logout</button>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCaPM6CNaiK-VZYR0-dkrrYMANiWi8pUGw",
  authDomain: "memodigital-57c0c.firebaseapp.com",
  projectId: "memodigital-57c0c",
  storageBucket: "memodigital-57c0c.firebasestorage.app",
  messagingSenderId: "612241421208",
  appId: "1:612241421208:web:119b13353da40aa51871ed",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<script>

const container = document.getElementById("dataContainer");

/* REALTIME DATA */
db.collection("pengajuan")
.orderBy("timestamp","desc")
.onSnapshot(snapshot=>{

container.innerHTML="";

if(snapshot.empty){
container.innerHTML="<div class='empty'>Belum ada pengajuan</div>";
return;
}

snapshot.forEach(doc=>{
const data = doc.data();

const card = document.createElement("div");
card.className="card";

const statusClass = data.status_admin==="sudah di input"
? "status-sudah"
: "status-belum";

const statusText = data.status_admin==="sudah di input"
? "Sudah Diproses"
: "Belum Diproses";

card.innerHTML=`
<h3>${data.jenis_pengajuan}</h3>
<div><span class="label">Nama:</span> ${data.nama}</div>
<div><span class="label">Departement:</span> ${data.departement}</div>
<div><span class="label">Plat:</span> ${Array.isArray(data.nomor_plat)?data.nomor_plat.join(", "):""}</div>
<div><span class="label">Kendaraan:</span> ${data.jenis_kendaraan||""}</div>
<div><span class="label">Periode:</span> ${data.periode_awal} s/d ${data.periode_akhir}</div>
<div><span class="label">Status:</span> <span class="${statusClass}">${statusText}</span></div>
<div class="button-group">
<button class="btn-approve">Approve</button>
<button class="btn-delete">Hapus</button>
</div>
`;

const approveBtn = card.querySelector(".btn-approve");
const deleteBtn = card.querySelector(".btn-delete");

/* APPROVE */
approveBtn.addEventListener("click",()=>{
db.collection("pengajuan").doc(doc.id).update({
status_admin:"sudah di input"
});
});

/* DELETE */
deleteBtn.addEventListener("click",()=>{
if(confirm("Yakin ingin menghapus data ini?")){
db.collection("pengajuan").doc(doc.id).delete();
}
});

container.appendChild(card);

});

});

</script>

</body>
</html>