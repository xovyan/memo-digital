<!DOCTYPE html>
<html>
<head>
  <title>Dashboard Admin</title>
  <style>
    body { font-family: Arial; padding:20px; }
    table { border-collapse: collapse; width:100%; }
    th, td { border:1px solid #ccc; padding:8px; text-align:left; }
    th { background:#f4f4f4; }
    .btn { padding:5px 10px; cursor:pointer; border:none; border-radius:4px; }
    .btn-hapus { background:red; color:white; }
    .btn-sudah { background:green; color:white; }
    .status-belum { color:red; font-weight:bold; }
    .status-sudah { color:green; font-weight:bold; }
  </style>
</head>
<body>

<h2>Dashboard Admin</h2>

<table>
  <thead>
    <tr>
      <th>Nama</th>
      <th>Judul</th>
      <th>Nomor Plat</th>
      <th>Status</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody id="dataBody"></tbody>
</table>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, onSnapshot, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "ISI_APIKEY_KAMU",
    authDomain: "ISI_AUTHDOMAIN_KAMU",
    projectId: "ISI_PROJECTID_KAMU",
    storageBucket: "ISI_STORAGE_KAMU",
    messagingSenderId: "ISI_SENDERID_KAMU",
    appId: "ISI_APPID_KAMU"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const dataBody = document.getElementById("dataBody");

  onSnapshot(collection(db, "pengajuan"), (snapshot) => {
    dataBody.innerHTML = "";

    snapshot.forEach((item) => {
      const data = item.data();
      const tr = document.createElement("tr");

      // FORMAT NOMOR PLAT PER BARIS
      let platFormatted = "-";

      if (Array.isArray(data.nomor_plat)) {
        platFormatted = data.nomor_plat.join("<br>");
      } else if (typeof data.nomor_plat === "string") {
        platFormatted = data.nomor_plat
          .split(",")
          .map(p => p.trim())
          .join("<br>");
      }

      const status = data.status || "Belum";

      tr.innerHTML = `
        <td>${data.nama || "-"}</td>
        <td>${data.judul || "-"}</td>
        <td>${platFormatted}</td>
        <td class="${status === 'Sudah' ? 'status-sudah' : 'status-belum'}">
          ${status}
        </td>
        <td>
          ${status !== "Sudah" ? 
            `<button class="btn btn-sudah" onclick="sudahInput('${item.id}')">Sudah Input</button>` 
            : ""}
          <button class="btn btn-hapus" onclick="hapusData('${item.id}')">Hapus</button>
        </td>
      `;

      dataBody.appendChild(tr);
    });
  });

  // HAPUS DATA
  window.hapusData = async (id) => {
    if(confirm("Yakin hapus data?")){
      await deleteDoc(doc(db, "pengajuan", id));
      alert("Data dihapus");
    }
  };

  // UBAH STATUS JADI SUDAH
  window.sudahInput = async (id) => {
    await updateDoc(doc(db, "pengajuan", id), {
      status: "Sudah"
    });
    alert("Status diubah menjadi Sudah");
  };
</script>

</body>
</html>