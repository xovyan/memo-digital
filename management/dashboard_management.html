<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Management</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:'Arial', sans-serif; }
body { background:#f4f6f9; min-height:100vh; }
header { background:#4e54c8; color:white; padding:15px; text-align:center; font-size:20px; }
nav { display:flex; justify-content:space-around; background:white; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
nav button { background:none; border:none; padding:15px; cursor:pointer; font-weight:bold; color:#4e54c8; }
nav button.active { border-bottom:3px solid #4e54c8; }
section { padding:15px; }
form input, form select, form textarea, form button { width:100%; margin-bottom:10px; padding:10px; border-radius:8px; border:1px solid #ccc; }
form button { background:#4e54c8; color:white; border:none; font-weight:bold; cursor:pointer; }
table { width:100%; border-collapse:collapse; margin-top:15px; background:white; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#4e54c8; color:white; }
tr:nth-child(even){ background:#f2f2f2; }
.status-baru { color:red; font-weight:bold; }
.status-sudah { color:green; font-weight:bold; }
</style>
</head>
<body>

<header>Dashboard Management</header>

<nav>
    <button class="tab-btn active" data-tab="pengajuan">Pengajuan</button>
    <button class="tab-btn" data-tab="riwayat">Riwayat Pengajuan</button>
    <button class="tab-btn" data-tab="ganti">Ganti Password</button>
    <button class="tab-btn" data-tab="logout">Log Out</button>
</nav>

<section id="content">

<!-- Pengajuan -->
<div class="tab" id="pengajuan">
<h3>Form Pengajuan</h3>
<form id="formPengajuan">
    <label>Jenis Pengajuan:</label>
    <select name="jenis_pengajuan" required>
        <option value="">--Pilih--</option>
        <option value="free parkir">Free Parkir</option>
        <option value="compliment">Compliment</option>
        <option value="ubah plat">Ubah Plat</option>
    </select>
    <label>Nama:</label>
    <input type="text" name="nama" required>
    <label>Departement:</label>
    <input type="text" name="departement" required>
    <label>Nomor Plat:</label>
    <input type="text" name="nomor_plat" required>
    <label>Jenis Kendaraan:</label>
    <input type="text" name="jenis_kendaraan">
    <label>Periode Awal:</label>
    <input type="date" name="periode_awal" required>
    <label>Periode Akhir:</label>
    <input type="date" name="periode_akhir" required>
    <label>Keterangan:</label>
    <textarea name="keterangan"></textarea>
    <button type="submit">Kirim</button>
</form>
</div>

<!-- Riwayat -->
<div class="tab" id="riwayat" style="display:none;">
<h3>Riwayat Pengajuan</h3>
<table>
<thead>
<tr>
<th>Jenis</th>
<th>Nama</th>
<th>Departement</th>
<th>Plat</th>
<th>Kendaraan</th>
<th>Periode</th>
<th>Keterangan</th>
<th>Status</th>
</tr>
</thead>
<tbody id="riwayatData"></tbody>
</table>
</div>

<!-- Ganti Password -->
<div class="tab" id="ganti" style="display:none;">
<h3>Ganti Password</h3>
<form id="formGanti">
<input type="password" name="password_lama" placeholder="Password Lama" required>
<input type="password" name="password_baru" placeholder="Password Baru" required>
<button type="submit">Ganti Password</button>
</form>
</div>

<!-- Logout -->
<div class="tab" id="logout" style="display:none;">
<h3>Log Out</h3>
<button id="btnLogout">Keluar</button>
</div>

</section>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// ======= FIREBASE CONFIG =======
const firebaseConfig = {
    apiKey: "API_KEY",
    authDomain: "PROJECT_ID.firebaseapp.com",
    projectId: "PROJECT_ID",
    storageBucket: "PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ======= TABS =======
const tabs = document.querySelectorAll('.tab-btn');
tabs.forEach(btn=>{
    btn.addEventListener('click',()=>{
        tabs.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.tab').forEach(tab=>tab.style.display='none');
        if(btn.dataset.tab==='pengajuan') document.getElementById('pengajuan').style.display='block';
        if(btn.dataset.tab==='riwayat') document.getElementById('riwayat').style.display='block';
        if(btn.dataset.tab==='ganti') document.getElementById('ganti').style.display='block';
        if(btn.dataset.tab==='logout') document.getElementById('logout').style.display='block';
    });
});

// ======= FORM PENGAJUAN =======
document.getElementById('formPengajuan').addEventListener('submit', async e=>{
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target).entries());
    data.status_admin = "belum"; // default
    data.timestamp = firebase.firestore.FieldValue.serverTimestamp();

    await db.collection('pengajuan').add(data);
    alert("Pengajuan berhasil dikirim ke admin!");
    e.target.reset();
});

// ======= RIWAYAT =======
function loadRiwayat(){
    db.collection('pengajuan').orderBy('timestamp','desc').onSnapshot(snapshot=>{
        const tbody = document.getElementById('riwayatData');
        tbody.innerHTML='';
        snapshot.forEach(doc=>{
            const d = doc.data();
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${d.jenis_pengajuan}</td>
                <td>${d.nama}</td>
                <td>${d.departement}</td>
                <td>${d.nomor_plat}</td>
                <td>${d.jenis_kendaraan||''}</td>
                <td>${d.periode_awal} s/d ${d.periode_akhir}</td>
                <td>${d.keterangan||''}</td>
                <td>${d.status_admin==='sudah' ? '<span class="status-sudah">Sudah di Input</span>' : '<span class="status-baru">Belum di Input</span>'}</td>
            `;
            tbody.appendChild(tr);
        });
    });
}
loadRiwayat();

// ======= GANTI PASSWORD & LOGOUT =======
document.getElementById('formGanti').addEventListener('submit', e=>{
    e.preventDefault();
    alert("Fungsi ganti password nanti disesuaikan Firebase Auth");
});
document.getElementById('btnLogout').addEventListener('click', ()=>{
    alert("Logout berhasil!"); 
    window.location.href="login_management.html";
});
</script>

</body>
</html>
