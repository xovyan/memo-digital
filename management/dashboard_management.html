<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Management</title>
<style>
body {
    font-family: 'Arial', sans-serif;
    background: #f0f2f5;
    margin: 0;
    padding: 0;
}
header {
    background: #4e54c8;
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
nav {
    display: flex;
    background: white;
    justify-content: space-around;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
nav button {
    flex: 1;
    padding: 12px;
    border: none;
    background: none;
    font-weight: bold;
    color: #4e54c8;
    cursor: pointer;
    transition: background 0.2s;
}
nav button.active, nav button:hover {
    border-bottom: 3px solid #4e54c8;
    background: #e8e9f2;
}
section {
    padding: 15px;
}
.tab {
    display: none;
}
.tab.active {
    display: block;
}

/* Form */
form {
    background: white;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}
form input, form select, form textarea, form button {
    width: 100%;
    margin-bottom: 10px;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 15px;
}
form button {
    background: #4e54c8;
    color: white;
    font-weight: bold;
    border: none;
    cursor: pointer;
    transition: background 0.2s;
}
form button:hover {
    background: #3b3fb8;
}

/* Table */
.table-container {
    overflow-x: auto;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    padding: 10px;
}
table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}
th, td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #ddd;
}
th {
    background: #4e54c8;
    color: white;
    position: sticky;
    top: 0;
}
tr:nth-child(even) {
    background: #f9f9f9;
}
.status-baru { color: red; font-weight: bold; }
.status-sudah { color: green; font-weight: bold; }

/* Responsive */
@media(max-width:600px){
    table, th, td { font-size: 12px; }
    form input, form select, form textarea, form button { padding: 10px; font-size: 14px; }
    header { font-size: 18px; }
}
</style>
</head>
<body>

<header>Dashboard Management</header>

<nav>
    <button class="tab-btn active" data-tab="pengajuan">Pengajuan</button>
    <button class="tab-btn" data-tab="riwayat">Riwayat</button>
    <button class="tab-btn" data-tab="ganti">Ganti Password</button>
    <button class="tab-btn" data-tab="logout">Log Out</button>
</nav>

<section id="content">

<!-- Form Pengajuan -->
<div class="tab active" id="pengajuan">
<h3>Form Pengajuan</h3>
<form id="formPengajuan">
    <select name="jenis_pengajuan" required>
        <option value="">--Pilih Jenis--</option>
        <option value="free parkir">Free Parkir</option>
        <option value="compliment">Compliment</option>
        <option value="ubah plat">Ubah Plat</option>
    </select>
    <input type="text" name="nama" placeholder="Nama" required>
    <input type="text" name="departement" placeholder="Departement" required>
    <input type="text" name="nomor_plat" placeholder="Nomor Plat (pisah koma jika banyak)" required>
    <input type="text" name="jenis_kendaraan" placeholder="Jenis Kendaraan">
    <input type="date" name="periode_awal" required>
    <input type="date" name="periode_akhir" required>
    <textarea name="keterangan" placeholder="Keterangan"></textarea>
    <button type="submit">Kirim</button>
</form>
</div>

<!-- Riwayat -->
<div class="tab" id="riwayat">
<h3>Riwayat Pengajuan</h3>
<div class="table-container">
<table>
<thead>
<tr>
<th>Jenis</th>
<th>Nama</th>
<th>Departement</th>
<th>Plat</th>
<th>Kendaraan</th>
<th>Periode</th>
<th>Keterangan</th>
<th>Status Admin</th>
</tr>
</thead>
<tbody id="riwayatData"></tbody>
</table>
</div>
</div>

<!-- Ganti Password -->
<div class="tab" id="ganti">
<h3>Ganti Password</h3>
<form id="formGanti">
<input type="password" name="password_lama" placeholder="Password Lama" required>
<input type="password" name="password_baru" placeholder="Password Baru" required>
<button type="submit">Ganti Password</button>
</form>
</div>

<!-- Logout -->
<div class="tab" id="logout">
<h3>Log Out</h3>
<button id="btnLogout">Keluar</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script type="module">
import { firebaseConfig, db } from './assets/firebase-config.js';
firebase.initializeApp(firebaseConfig);

// Tab switching
const tabs = document.querySelectorAll('.tab-btn');
tabs.forEach(btn=>{
    btn.addEventListener('click',()=>{
        tabs.forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(tab=>tab.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
    });
});

// Form Pengajuan
document.getElementById('formPengajuan').addEventListener('submit', async e=>{
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target).entries());
    data.status_admin = "belum";
    data.timestamp = firebase.firestore.FieldValue.serverTimestamp();

    const nopolArr = data.nomor_plat.split(',').map(n=>n.trim()).filter(n=>n);
    try{
        for(const n of nopolArr){
            await db.collection('pengajuan').add({...data, nomor_plat: n});
        }
        alert("Pengajuan berhasil dikirim ke admin!");
        e.target.reset();
    }catch(err){
        alert("Terjadi kesalahan: "+err);
    }
});

// Riwayat Realtime
function loadRiwayat(){
    db.collection('pengajuan').orderBy('timestamp','desc')
    .onSnapshot(snapshot=>{
        const tbody = document.getElementById('riwayatData');
        tbody.innerHTML='';
        snapshot.forEach(doc=>{
            const d = doc.data();
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${d.jenis_pengajuan}</td>
                <td>${d.nama}</td>
                <td>${d.departement}</td>
                <td>${d.nomor_plat}</td>
                <td>${d.jenis_kendaraan||''}</td>
                <td>${d.periode_awal} s/d ${d.periode_akhir}</td>
                <td>${d.keterangan||''}</td>
                <td>${d.status_admin==='sudah' ? '<span class="status-sudah">Sudah di Input</span>' : '<span class="status-baru">Belum di Input</span>'}</td>
            `;
            tbody.appendChild(tr);
        });
    });
}
loadRiwayat();

// Ganti Password
document.getElementById('formGanti').addEventListener('submit', e=>{
    e.preventDefault();
    alert("Fungsi ganti password akan menggunakan Firebase Auth nanti.");
});

// Logout
document.getElementById('btnLogout').addEventListener('click', ()=>{
    localStorage.removeItem('management');
    window.location.href="login_management.html";
});
</script>

</body>
</html>